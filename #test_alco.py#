\# -*- coding: utf-8 -*-
from time import sleep
import matplotlib.pyplot as plt
import serial
import time
import numpy as np
import random  # 模拟酒精浓度数据
import serial.tools.list_ports

class AlcoholDetector:
    def __init__(self, port='/dev/tty.usbserial-130', baudrate=9600):
        self.port = port
        self.baudrate = baudrate

    def infer_loop(self):
        ser = None
        try:

            ser = serial.Serial(self.port, self.baudrate, timeout=1)

            if ser.is_open:
                # print(f"Connected to {self.port} at {self.baudrate} baud rate")
                print "yes"

            while True:
                # 从串口读取数据
                # message = ser.readline().decode('utf-8').strip()  # 读取并解码
                message = ser.readline().strip()

                if message:
                    print(ord(message[4]))
                    print "Received:{}".format(message)
                    # 解析出每个字节的值
                    parsed_values = [byte for byte in message]

                    # 打印解析后的值
                    # print("Parsed values:", parsed_values)
                    if len(parsed_values) == 9:
                        a = parsed_values[4] * 256 + parsed_values[5]
                        b = parsed_values[6] * 256 + parsed_values[7]
                        print "浓度值: {}/{}".format(a, b)

                    else:
                        print "出error"

                print "==============="

        except serial.SerialException as e:

            print "Error"

        finally:
            if ser is not None and ser.is_open:
                ser.close()


plist = list(serial.tools.list_ports.comports())
print(plist[0][0])

if __name__=="__main__":
    # 设置串口参数
    port = plist[0][0]  # 串口设备路径
    baudrate = 9600  # 波特率
    alcohol_queue = [0] * 20

    alcohol_detector = AlcoholDetector(port, baudrate)
    alcohol_detector.infer_loop()





